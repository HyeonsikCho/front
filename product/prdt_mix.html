<?
include_once($_SERVER["DOCUMENT_ROOT"] . "/common/sess_common.php");
include_once($_SERVER["DOCUMENT_ROOT"] . "/com/nexmotion/common/util/Template.php");
include_once($_SERVER["DOCUMENT_ROOT"] . "/com/nexmotion/common/util/ConnectionPool.php");
include_once($_SERVER["DOCUMENT_ROOT"] . "/com/nexmotion/job/common/ProductCommonDAO.php");
include_once($_SERVER["DOCUMENT_ROOT"] . "/product/info/SheetCutInfo.php");
include_once($_SERVER["DOCUMENT_ROOT"] . "/product/info/BookletInnerInfo.php");
include_once($_SERVER["DOCUMENT_ROOT"] . '/define/member_grade.php');

$connectionPool = new ConnectionPool();
$conn = $connectionPool->getPooledConnection();

$template = new Template();
$dao = new ProductCommonDAO();

// 책자 상품 정보 처리부분 include
// 사진, 배너, 카테고리 셀렉트박스
include_once($_SERVER["DOCUMENT_ROOT"] . "/product/info/common_info.php");
// 옵션부분
include_once($_SERVER["DOCUMENT_ROOT"] . "/product/info/opt_info.php");
// 가격부분

$cut_info = new SheetCutInfo($conn,
                             $template,
                             "001001001",
                             "cut",
                             $fb->session("sell_site"));
$inner_info = new BookletInnerInfo($conn,
                                   $template,
                                   "011003001",
                                   "inner",
                                   $fb->session("sell_site"));
// 회원등급
if (empty($fb->session("grade_name_en")) === true) {
    $template->reg("grade_name", "로그인 후 확인 가능합니다.");
} else {
    $dscr  = sprintf("회원등급 : %s", $fb->session("grade_name_en"));
    $template->reg("grade_name", $dscr);
}
// 빠른견적서 틀
$template->reg("quick_esti", getQuickEstimateHtml(array())); 

// 낱장 재단형
$cut_sell_price       = $cut_info->sell_price;
$cut_grade_sale_rate  = $cut_info->grade_sale_rate;
$cut_grade_sale_price = $cut_info->grade_sale_price;
$cut_sale_price       = $cut_info->sale_price;

$template->reg("cut_sell_price"     , $cut_sell_price);
$template->reg("cut_grade_sale_rate", $cut_grade_sale_rate);
$template->reg("cut_sale_price"     , $cut_sale_price);
// 책자형 내지
$inner_sell_price       = $inner_info->sell_price;
$inner_grade_sale_rate  = $inner_info->grade_sale_rate;
$inner_grade_sale_price = $inner_info->grade_sale_price;
$inner_sale_price       = $inner_info->sale_price;
$inner_paper_price      = $inner_info->paper_price;
$inner_print_price      = $inner_info->print_price;
$inner_output_price     = $inner_info->output_price;

$template->reg("inner_sell_price"     , $inner_sell_price);
$template->reg("inner_grade_sale_rate", $inner_grade_sale_rate);
$template->reg("inner_sale_price"     , $inner_sale_price);
$template->reg("inner_paper_price"    , $inner_paper_price);
$template->reg("inner_print_price"    , $inner_print_price);
$template->reg("inner_output_price"   , $inner_output_price);
// 주문페이지에 보여줄 계산된 금액
// 정상판매가
$sell_price       = $cut_sell_price + $inner_sell_price;
// 회원등급 할인
$grade_sale_price = $cut_grade_sale_price + $inner_grade_sale_price;
// 기본할인가
$sale_price       = $cut_sale_price + $inner_sale_price;
// 기본옵션가격
$opt_price        = $inner_info->opt_price;

$template->reg("sell_price"       , number_format($sell_price));
$template->reg("grade_sale_price" , number_format($grade_sale_price));
$template->reg("sale_price"       , number_format($sale_price));
$template->reg("opt_default_price", $opt_price);

// 로그인 상태인지 체크하는부분 include
include_once($_SERVER["DOCUMENT_ROOT"] . "/common/login_check.php");

// 기본사용 자바스크립트, css 파일 불러오는 용
$template->reg("dir", "product"); 
$template->reg("page", "prdt_mix"); 

//design_dir 경로
$template->reg("design_dir", "/design_template"); 
$template->htmlPrint($_SERVER["PHP_SELF"]); 

$conn->Close();
?>
